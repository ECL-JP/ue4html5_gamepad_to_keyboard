# ue4html5_gamepad_to_keyboard
～ UE4.23 HTML5ゲームを無理やりゲームパッドに対応させる簡易ライブラリ ～

(c)2022 by Emily&Charlotte Lounge   
[https://emilycharlotte.jp/](https://emilycharlotte.jp/)
   
バージョン 0.7.0.0   
作成日 2022-06-19   
更新日 2022-06-22   

## ■動作サンプル
   
[https://app.emilycharlotte.jp/ue4html5_gamepad_to_keyboard/](https://app.emilycharlotte.jp/ue4html5_gamepad_to_keyboard/)

## ■ライセンス(めんどくさいので簡単に)

・サポートも保障も補償もしませんが、権利は放棄しません。   
・このスクリプト単体での転載、再配布、販売等は禁止(改変してても駄目)。   
・ブログ等の技術的な記事で部分的に引用することは可。   
・使用に際し改変することは自由。不要な部分やコメントを削除してもOK。   
・このスクリプトを使用したゲームやウェブコンテンツの配信は無償、有償いずれも可。   
・クレジット表示や使用報告は不要。   

## ■仕組み

Unbreal Engine 4の4.23(4.24ではコミュニティによる対応)は標準でHTML5(WebGL)出力に対応していますが、ゲームパッドでの操作ができません。

このスクリプトではゲームパッドの状態を監視し、入力があればそれに対応したキーボードのイベントを発生させることで、UE4にキー入力があったと錯覚させることでゲームパッドによる操作を可能とします。

## ■使用するもの

・UE4.23.1 (他のバージョンは未確認)   
・Firefox、Chrome、Edge (いずれも2022-06-19時点のバージョン)   
・UTF-8対応のいい感じのテキストエディタ   

## ■使い方

1.  UEからShipping設定でプロジェクトのHTML5パッケージ化を行います。

2.  "ue4html5_gamepad_to_keyboard.js"ファイルを"プロジェクト名.html"と同じフォルダにコピーします。

3.  "ue4html5_gamepad_to_keyboard.js"の途中にあるue4html5_gamepadKeyboardLinkを見つけて必要に応じて書き換えます。

4.  出力された"プロジェクト名.html"の後ろのほうにある下記行を見つけます。   
    `<script src="html5_sample-HTML5-Shipping.UE4.js"></script>`

5.  4で見つけた行の次の行に下記を追加します。   
    `<script src="ue4html5_gamepad_to_keyboard.js"></script>`

6.  まずはローカル環境で正しく動作するか確認してください。

## ■制限

・趣味で作ったものなのでサポートは期待しないでください。

・組み込みやすさ重視で1ファイルにまとめてます。

・UE側の作り方や、クライアントの環境によっては正しく動作しない場合があります。

・めんどくさいのでキーリストはWindowsのJPキーボードのしか用意してません。

・必ずしもすべてのキーに対応できるというわけではありません。   
  できればUE側にキーボード操作とゲームパッド操作を切り替える機能を設け、ゲームパッドのキーマッピングをフルキーのA～Zに集中させるといった方法をとってください(JPやUSキーボードならA～Zは確実に取れるので)。

・ゲームパッドの入力をキーボード入力に置き換えるため、アナログスティックやトリガー等の滑らかな変化には非対応です。   
  たとえば、左スティックが上方向に倒されたら、入力値が0.5以上ならWキー、0.5未満ならSHIFT+Wキーのような対応になります。

・左右トリガーはアナログではなくオン|オフのみです。

・UE側のHTML5パッケージ化の仕様上、SHIFT、CTRL、ALT等の左右の区別はできません。

・ゲームパッドの入力からキーイベント発生まで、数フレームの遅延があります。   
  同時に押したボタンが多いほど遅延も大きくなります。

・プレイヤーによるカスタマイズ機能は用意されていません。   
  キーマッピング情報は変数に格納されているので、独自にjavascriptでキー設定ダイアログを出すなどして対応させることは可能です(UE側にポーズ機能も必要)。   
  もしくはUE側にキー設定機能を持たせて、ajax等のローカル通信でjavascript側に設定を送り込むという方法も使えるかもしれません(試してませんが)。
